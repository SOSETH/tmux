---
- set_fact:
    powerline_packages:
      - powerline
  when: ansible_distribution == "Debian"

- set_fact:
    powerline_packages:
      - powerline
      - tmux-powerline
  when: ansible_distribution == "Fedora"

- name: install packages
  package:
    name: "{{ item }}"
    state: present
  with_items:
    - tmux
    - "{{ powerline_packages }}"
    
- name: detect tmux version
  shell: tmux -V | cut -d ' ' -f2
  register: tmux_version
  changed_when: False
  check_mode: no
  
- name: generate system-wide tmux config
  template:
    src: tmux.conf.j2
    dest: /etc/tmux.conf
    owner: root
    group: root
    mode: 0644
  
- name: ensure tmux powerline config directories exist
  file: 
    path: "{{ item }}"
    state: directory
    owner: root
    group: root
    mode: 0755
  with_items:
    - /etc/xdg/powerline/colorschemes/tmux
    - /etc/xdg/powerline/themes/tmux
  
- name: copy powerline config
  copy: 
    src: powerline_config.json
    dest: /etc/xdg/powerline/config.json
    owner: root
    group: root
    mode: 0644
  
- name: copy tmux powerline config
  copy:
    src: powerline_tmux_vsos.json
    dest: /etc/xdg/powerline/themes/tmux/vsos.json
    owner: root
    group: root
    mode: 0644
  
- name: copy tmux powerline colorscheme
  copy: 
    src: powerline_color_tmux_vsos.json
    dest: /etc/xdg/powerline/colorschemes/tmux/vsos.json
    owner: root
    group: root
    mode: 0644
